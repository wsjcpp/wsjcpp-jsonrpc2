<!DOCTYPE html>
<html>
<head>
    <meta http-equiv='Content-Type' content='text/html; charset=utf-8'/>    <script src='dist/libwsjcppjson20client.js'></script>
    <script>
        function formattedDate(d = new Date) {
            const year = String(d.getFullYear());
            let month = String(d.getMonth() + 1);
            if (month.length < 2) month = '0' + month;
            let day = String(d.getDate());
            if (day.length < 2) day = '0' + day;
            let hours = String(d.getHours());
            if (hours.length < 2) hours = '0' + hours;
            let mins = String(d.getMinutes());
            if (mins.length < 2) mins = '0' + mins;
            let secs = String(d.getSeconds());
            if (secs.length < 2) secs = '0' + secs;
            return `${year}-${month}-${day} ${hours}:${mins}:${secs}`;
        }
        function log(n) {
            console.log(n);
            var log = document.getElementById('log');
            log.innerHTML += '[' + formattedDate() + '] ' + n + '\r\n';
        };
        var client = SomeClient
        document.addEventListener('DOMContentLoaded', function() {
            client.bindNotification('chat', function(data) {
                log('notify: ' + JSON.stringify(data))
            });
            client.bindNotification('server', function(data) {
                log('notify: ' + JSON.stringify(data))
            });
            client.bindEvent('connected', function(data) {
                log('connected: ' + JSON.stringify(data))
                connecting_form.style.display = 'none';
                login_form.style.display = '';
                logout_form.style.display = 'none';
            });
            client.bindEvent('disconnected', function(data) {
                log('disconnected: ' + JSON.stringify(data))
                connecting_form.style.display = '';
                login_form.style.display = 'none';
                logout_form.style.display = 'none';
            });
            client.bindEvent('reconnecting', function(data) {
                log('reconnecting: ' + JSON.stringify(data))
            });
            client.bindEvent('broken', function(data) {
                log('broken: ' + JSON.stringify(data))
            });
        });
    </script>
</head>
<body>
<div id='connecting_form'>
    <h1>Connect to Server</h1>
    <input type='text' id='server_url'><br>
    <button id='btn_connect'>Connect</button>
</div>
<div id='login_form' style='display: none'>
    <h1>Login</h1>
    <input type='text' id='login'><br>
    <input type='password' id='password'><br>
    <button id='btn_login'>Login</button>
</div>
<div id='logout_form' style='display: none'>
    <h1>Connected</h1>
    <button id='btn_logout'>Logout</button>
</div>
<script>
    server_url.value = 'ws://localhost:1234/'
    btn_login.onclick = function() {
        client.auth_login({login: login.value, password: password.value}).done(function(r) { 
            log('Login success, token = ' + r.token);
        }).fail(function(e) {
            log('Login failed, error = ' + e.error);
        })
    }
    btn_logout.onclick = function() {
        client.deinit();
    }
    btn_connect.onclick = function() {
        client.init({'baseUrl': server_url.value});
    }
</script>
<pre id='log'></pre>
</body>
</html>
